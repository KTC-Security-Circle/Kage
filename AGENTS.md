# Kage ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ AI é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## 1. åŸºæœ¬æ–¹é‡ (Core Directives)

### 1.1. å½¹å‰² (Role)

Python ã«ã‚ˆã‚‹ Windows ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªé–‹ç™ºã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã¨ã—ã¦ã€ãƒ¢ãƒ€ãƒ³ãª UI ã¨ä¿å®ˆæ€§ã®é«˜ã„ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã€‚

### 1.2. åŸå‰‡ (Principles)

- è¨€èª: å›ç­”ã¯æ—¥æœ¬èªã§è¡Œã†ã€‚
- æ˜ç¢ºæ€§: ç°¡æ½”ã‹ã¤å¹³æ˜“ãªèª¬æ˜ã‚’å¾¹åº•ã™ã‚‹ã€‚
- å…·ä½“æ€§: ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ã€å¿…ãšå…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰ä¾‹ã‚’ä¼´ã£ã¦æç¤ºã™ã‚‹ã€‚
- å“è³ª: ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¸¸ã«è€ƒæ…®ã™ã‚‹ã€‚
- è¨­è¨ˆæ”¹å–„: ã‚ˆã‚Šã‚¯ãƒªãƒ¼ãƒ³ã§è²¬å‹™ãŒåˆ†å‰²ã•ã‚ŒãŸè¨­è¨ˆãŒå¯èƒ½ã§ã‚ã‚Œã°ã€æ”¹å–„æ¡ˆã‚’æç¤ºã™ã‚‹ã€‚
- æœ€æ–°æƒ…å ±: Context7 MCP ã‚’ä½¿ç”¨ã—ã€æœ€æ–°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹ã€‚

## 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ (Project Overview)

- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å: Kage
- ç›®çš„: LLM ã‚’æ´»ç”¨ã—ãŸã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯:
  - è¨€èª: Python 3.12+
  - UI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯: Flet
  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†: uv
  - ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼: poethepoet
- ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª: pyproject.toml ã‚’æ­£ã¨ã—ã¦å‚ç…§ã™ã‚‹ã“ã¨ã€‚

## 3. é–‹ç™ºã‚³ã‚¢åŸå‰‡ (Core Development Principles)

### 3.1. ã‚³ãƒ¼ãƒ‰å“è³ª (Code Quality)

å…¨ã¦ã® Python ã‚³ãƒ¼ãƒ‰ã«ã¯ã€å‹ãƒ’ãƒ³ãƒˆã¨æˆ»ã‚Šå€¤ã®å‹ã‚’å¿…ãšå«ã‚ã‚‹ã“ã¨ã€‚
å¤‰æ•°åã‚„é–¢æ•°åã¯ã€ãã®å½¹å‰²ãŒã²ã¨ç›®ã§ç†è§£ã§ãã‚‹ã€è‡ªå·±èª¬æ˜çš„ãªåç§°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚

âŒ Bad:

```python
def p(u, d):
    return [x for x in u if x not in d]
```

âœ… Good:

```python
def filter_unknown_users(users: list[str], known_users: set[str]) -> list[str]:
    """Filter out users that are not in the known users set.

    Args:
        users: List of user identifiers to filter.
        known_users: Set of known/valid user identifiers.

    Returns:
        List of users that are not in the known_users set.
    """
    return [user for user in users if user not in known_users]
```

ã‚¹ã‚¿ã‚¤ãƒ«è¦ä»¶:

- èª¬æ˜çš„ã§ã‚ã‹ã‚Šã‚„ã™ã„å¤‰æ•°åã‚’ä½¿ç”¨ã™ã‚‹ã€‚çŸ­ã™ãã‚‹è­˜åˆ¥å­ã‚„é›£è§£ãªè­˜åˆ¥å­ã¯é¿ã‘ã‚‹ã€‚
- è¤‡é›‘ãªé–¢æ•°ï¼ˆ20 è¡Œä»¥ä¸Šï¼‰ã‚’ã€æ„å‘³ã®ã‚ã‚‹å°ã•ãªç„¦ç‚¹ã‚’çµã£ãŸé–¢æ•°ã«åˆ†å‰²ã™ã‚‹ã€‚
- ä¸å¿…è¦ãªæŠ½è±¡åŒ–ã‚„æ™‚æœŸå°šæ—©ã®æœ€é©åŒ–ã‚’é¿ã‘ã‚‹ã€‚
- å¤‰æ›´ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®æ—¢å­˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†ã€‚

### 3.2. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (Documentation)

å…¨ã¦ã®å…¬é–‹é–¢æ•°ã«ã¯ã€Google ã‚¹ã‚¿ã‚¤ãƒ«ã® docstring ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã€‚
å¼•æ•°ï¼ˆArgsï¼‰ã€æˆ»ã‚Šå€¤ï¼ˆReturnsï¼‰ã€ç™ºç”Ÿã—ã†ã‚‹ä¾‹å¤–ï¼ˆRaisesï¼‰ã‚’æ˜è¨˜ã™ã‚‹ã€‚

âŒ Bad:

```python
def send_notification(to, msg):
    """é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹"""
```

âœ… Good:

```python
def send_notification(to_address: str, message: str) -> bool:
    """æŒ‡å®šã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹

    Args:
        to_address: é€ä¿¡å…ˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
        message: é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ¬æ–‡

    Returns:
        é€ä¿¡ã«æˆåŠŸã—ãŸå ´åˆã¯Trueã€ãã‚Œä»¥å¤–ã¯False

    Raises:
        InvalidEmailError: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒä¸æ­£ãªå ´åˆ
        SMTPConnectionError: ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã«å¤±æ•—ã—ãŸå ´åˆ
    """
```

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³:

- å‹ã¯é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£å†…ã«è¨˜è¼‰ã—ã€docstring å†…ã«è¨˜è¼‰ã—ãªã„ã€‚
- èª¬æ˜ã§ã¯ã€Œä½•ã€ã§ã¯ãªãã€Œãªãœã€ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹ã€‚
- ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€æˆ»ã‚Šå€¤ã€ä¾‹å¤–ã‚’æ–‡æ›¸åŒ–ã™ã‚‹ã€‚
- èª¬æ˜ã¯ç°¡æ½”ã‹ã¤æ˜ç¢ºã«ã€‚

ğŸ“Œ ãƒ’ãƒ³ãƒˆ:èª¬æ˜ã¯ç°¡æ½”ã‹ã¤æ˜ç¢ºã«ã—ã¾ã—ã‚‡ã†ã€‚æˆ»ã‚Šå€¤ã¯ã€æ˜ã‚‰ã‹ã§ãªã„å ´åˆã«ã®ã¿è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

### 3.3. ãƒ†ã‚¹ãƒˆ (Testing)

ã™ã¹ã¦ã®æ–°æ©Ÿèƒ½ã¾ãŸã¯ãƒã‚°ä¿®æ­£ã¯ã€ãƒ¦ãƒ‹ãƒƒãƒˆ ãƒ†ã‚¹ãƒˆã§ã‚«ãƒãƒ¼ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ãƒ†ã‚¹ãƒˆçµ„ç¹”:

- `tests/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã”ã¨ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’é…ç½®
- `pytest`ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦ä½¿ç”¨

ãƒ†ã‚¹ãƒˆå“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:

[ ] æ–°ã—ã„ãƒ­ã‚¸ãƒƒã‚¯ãŒå£Šã‚Œã¦ã„ã‚‹ã¨ãƒ†ã‚¹ãƒˆã¯å¤±æ•—ã™ã‚‹
[ ] ãƒãƒƒãƒ”ãƒ¼ãƒ‘ã‚¹ã¯ã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ã¾ã™
[ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã¨ã‚¨ãƒ©ãƒ¼æ¡ä»¶ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã‚‹
[ ] å¤–éƒ¨ä¾å­˜é–¢ä¿‚ã«ã¯ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£/ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹
[ ] ãƒ†ã‚¹ãƒˆã¯æ±ºå®šè«–çš„ã§ã‚ã‚‹ï¼ˆä¸å®‰å®šãªãƒ†ã‚¹ãƒˆã¯ãªã„ï¼‰

ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®è³ªå•:

[ ] æ–°ã—ã„ãƒ­ã‚¸ãƒƒã‚¯ãŒå£Šã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ†ã‚¹ãƒˆ ã‚¹ã‚¤ãƒ¼ãƒˆã¯å¤±æ•—ã—ã¾ã™ã‹?
[ ] äºˆæƒ³ã•ã‚Œã‚‹å‹•ä½œã¯ã™ã¹ã¦å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã‹ (ãƒãƒƒãƒ”ãƒ¼ãƒ‘ã‚¹ã€ç„¡åŠ¹ãªå…¥åŠ›ãªã©)?
[ ] ãƒ†ã‚¹ãƒˆã§ã¯å¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã¾ãŸã¯ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã‹?

```python
def test_filter_unknown_users():
    """Test filtering unknown users from a list."""
    users = ["alice", "bob", "charlie"]
    known_users = {"alice", "bob"}

    result = filter_unknown_users(users, known_users)

    assert result == ["charlie"]
    assert len(result) == 1
```

### 3.4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (Security)

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:

- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ä¼´ã† eval(), exec(), pickle ã¯ä½¿ç”¨ã—ãªã„ã€‚
- log ã‚„ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¯ `loguru` ã‚’ä½¿ç”¨ã—ã€é©åˆ‡ã«ãƒ­ã‚°ã‚’è¨˜éŒ²ã™ã‚‹ã€‚
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒ³ãƒ‰ãƒ«ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ç¢ºå®Ÿã«ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ã€‚

## 4. UI/UX ã¨ Flet è¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ (UI/UX & Flet Design)

### 4.1. åŸºæœ¬æ–¹é‡

ãƒ¢ãƒ€ãƒ³ã§ç›´æ„Ÿçš„ãªãƒ‡ã‚¶ã‚¤ãƒ³ã‚’åŸºæœ¬ã¨ã™ã‚‹ã€‚

Flet ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’åŠ¹æœçš„ã«ä½¿ç”¨ã—ã€ã‚¯ãƒªãƒ¼ãƒ³ã§å¿œç­”æ€§ã®é«˜ã„ UI ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

### 4.2. Flet å›ºæœ‰ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–: è¤‡æ•°ã®è¦ç´ ã‹ã‚‰ãªã‚‹è¤‡é›‘ãª UI éƒ¨å“ã¯ã€ft.UserControl ã‚’ç¶™æ‰¿ã—ãŸã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®šç¾©ã—ã€å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ã€‚

çŠ¶æ…‹ç®¡ç†(State Management): ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºã«é–¢ã‚ã‚‹çŠ¶æ…‹ï¼ˆãƒ‡ãƒ¼ã‚¿ï¼‰ã¯ã€UI ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‹ã‚‰åˆ†é›¢ã•ã‚ŒãŸå°‚ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã§ç®¡ç†ã™ã‚‹ã“ã¨ã€‚UI ã®æ›´æ–°ã¯ã€ãã®ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã®å¤‰æ›´ã‚’èµ·ç‚¹ã« page.update()ã‚’å‘¼ã³å‡ºã™è¨­è¨ˆã‚’åŸºæœ¬ã¨ã™ã‚‹ã€‚

ãƒ†ãƒ¼ãƒã¨ã‚¹ã‚¿ã‚¤ãƒ«: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®è‰²ã€ãƒ•ã‚©ãƒ³ãƒˆã€é–“éš”ãªã©ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ã€ä¸€å…ƒç®¡ç†ã•ã‚ŒãŸ theme.py ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã—ã€UI ã®ä¸€è²«æ€§ã‚’ä¿ã¤ã“ã¨ã€‚

## 5. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ (Architectural Guidelines)

### 5.1. LLM é€£æºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- API ã‚­ãƒ¼ç®¡ç†: API ã‚­ãƒ¼ã‚„èªè¨¼æƒ…å ±ã‚’ã‚³ãƒ¼ãƒ‰å†…ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ãªã„ã€‚ç’°å¢ƒå¤‰æ•° (os.getenv) ã¾ãŸã¯ã€python-dotenv ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†: LLM ã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ã€Python ã‚³ãƒ¼ãƒ‰ã‹ã‚‰åˆ†é›¢ã—ã€prompts/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãªã©ã«ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚„ YAML ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ç®¡ç†ã™ã‚‹ã€‚
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: LLM API å‘¼ã³å‡ºã—æ™‚ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€æ¥ç¶šã‚¨ãƒ©ãƒ¼ã€API ã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æƒ³å®šã—ãŸã€å …ç‰¢ãªä¾‹å¤–å‡¦ç†ã¨ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã€‚

### 5.2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

äºˆæ¸¬å¯èƒ½ã§ä¿å®ˆæ€§ã®é«˜ã„é–‹ç™ºã®ãŸã‚ã€ä»¥ä¸‹ã®ç¾çŠ¶ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä¾‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

Kage/
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ uv.lock
â”œâ”€â”€ docs/ # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚ â”œâ”€â”€ app/
â”‚ â”œâ”€â”€ dev/
â”‚ â””â”€â”€ ...
â”œâ”€â”€ scripts/ # é–‹ç™ºç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚ â”œâ”€â”€ **init**.py
â”‚ â””â”€â”€ ...
â”œâ”€â”€ src/ # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“
â”‚ â”œâ”€â”€ config.py # è¨­å®šç®¡ç†
â”‚ â”œâ”€â”€ logging_conf.py # ãƒ­ã‚°è¨­å®š
â”‚ â”œâ”€â”€ main.py # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚ â”œâ”€â”€ router.py # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚ â”œâ”€â”€ agents/ # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–¢é€£
â”‚ â”œâ”€â”€ assets/ # ç”»åƒãƒ»ãƒ•ã‚©ãƒ³ãƒˆç­‰
â”‚ â”œâ”€â”€ cli/ # CLI é–¢é€£
â”‚ â”œâ”€â”€ logic/ # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚ â”œâ”€â”€ models/ # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚ â”‚ â””â”€â”€ migrations/ # Alembic ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚ â”œâ”€â”€ settings/ # è¨­å®šç®¡ç†
â”‚ â””â”€â”€ views/ # Flet ç”»é¢(View)
â””â”€â”€ tests/ # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ agents/
â”œâ”€â”€ logic/
â”œâ”€â”€ settings/
â””â”€â”€ ...

â€»ä¸»è¦ãªã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å½¹å‰²ï¼š

- src/ï¼šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ã‚¢å®Ÿè£…ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ¢ãƒ‡ãƒ«ã€ãƒ“ãƒ¥ãƒ¼ç­‰ã‚’å«ã‚€ï¼‰
- tests/ï¼špytest ã«ã‚ˆã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ
- docs/ï¼šé–‹ç™ºãƒ»è¨­è¨ˆãƒ»åˆ©ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- scripts/ï¼šè£œåŠ©ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

src/é…ä¸‹ã®æ§‹æˆï¼š
src/
â”œâ”€â”€ agents/ # LLM ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç­‰
â”œâ”€â”€ assets/ # ç”»åƒãƒ»ãƒ•ã‚©ãƒ³ãƒˆç­‰
â”œâ”€â”€ cli/ # CLI ã‚³ãƒãƒ³ãƒ‰
â”œâ”€â”€ logic/ # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚ â”œâ”€â”€ application/ # Application Service å±¤ï¼ˆView å±¤ã¨ Service å±¤ã®æ©‹æ¸¡ã—ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ï¼‰
â”‚ â”œâ”€â”€ services/ # Domain Service å±¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«å®Ÿè£…ï¼‰
â”‚ â”œâ”€â”€ repositories/ # Repository å±¤ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹æŠ½è±¡åŒ–ã€SQLModel ãƒ™ãƒ¼ã‚¹ï¼‰
â”‚ â”œâ”€â”€ factory.py # ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¯ãƒˆãƒªï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰
â”‚ â””â”€â”€ unit_of_work.py # Unit of Work ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ï¼‰
â”œâ”€â”€ models/ # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚ â””â”€â”€ migrations/ # Alembic ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ settings/ # è¨­å®šç®¡ç†
â””â”€â”€ views/ # Flet ãƒ“ãƒ¥ãƒ¼å±¤
â”œâ”€â”€ layout.py # å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”Ÿæˆ
â”œâ”€â”€ shared/ # å…±é€šéƒ¨å“ï¼ˆBaseView, AppBar ç­‰ï¼‰
â”œâ”€â”€ home/ # ãƒ›ãƒ¼ãƒ ç”»é¢
â”œâ”€â”€ tasks/ # ã‚¿ã‚¹ã‚¯ç®¡ç†ç”»é¢
â”œâ”€â”€ memos/ # ãƒ¡ãƒ¢ç®¡ç†ç”»é¢
â”œâ”€â”€ projects/ # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ç”»é¢
â”œâ”€â”€ tags/ # ã‚¿ã‚°ç®¡ç†ç”»é¢
â”œâ”€â”€ terms/ # ç”¨èªç®¡ç†ç”»é¢
â”œâ”€â”€ weekly_review/ # é€±æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢
â””â”€â”€ **init**.py # ä¸»è¦ View ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### 5.3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ”¹å–„

æ”¹å–„ã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã«é­é‡ã—ãŸå ´åˆã¯ã‚ˆã‚Šè‰¯ã„è¨­è¨ˆã‚’ææ¡ˆã™ã‚‹

âŒ è²§å¼±ãªãƒ‡ã‚¶ã‚¤ãƒ³:

```python
def process_data(data, db_conn, email_client, logger):
    # Function doing too many things
    validated = validate_data(data)
    result = db_conn.save(validated)
    email_client.send_notification(result)
    logger.log(f"Processed {len(data)} items")
    return result
```

âœ… ã‚ˆã‚Šè‰¯ã„ãƒ‡ã‚¶ã‚¤ãƒ³:

```python
@dataclass
class ProcessingResult:
    """Result of data processing operation."""
    items_processed: int
    success: bool
    errors: List[str] = field(default_factory=list)

class DataProcessor:
    """Handles data validation, storage, and notification."""

    def __init__(self, db_conn: Database, email_client: EmailClient):
        self.db = db_conn
        self.email = email_client

    def process(self, data: List[dict]) -> ProcessingResult:
        """Process and store data with notifications.

        Args:
            data: List of data items to process.

        Returns:
            ProcessingResult with details of the operation.
        """
        validated = self._validate_data(data)
        result = self.db.save(validated)
        self._notify_completion(result)
        return result
```

è¨­è¨ˆæ”¹å–„é ˜åŸŸ:

ã‚ˆã‚Š **ã‚¯ãƒªãƒ¼ãƒ³** ã§ã€ã‚ˆã‚Š **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«** ã§ã€ã‚ˆã‚Š **ã‚·ãƒ³ãƒ—ãƒ«** ãªãƒ‡ã‚¶ã‚¤ãƒ³ãŒã‚ã‚‹å ´åˆã¯ã€ãã‚Œã‚’å¼·èª¿ã—ã€æ¬¡ã®ã‚ˆã†ãªæ”¹å–„ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚

- å…±æœ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã®å‰Šæ¸›
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ç°¡å˜ã«ã™ã‚‹
- é–¢å¿ƒã®åˆ†é›¢ï¼ˆå˜ä¸€è²¬ä»»ï¼‰ã‚’æ”¹å–„ã™ã‚‹
- ä¾å­˜æ€§æ³¨å…¥ã«ã‚ˆã‚Šãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å®¹æ˜“ã«ã™ã‚‹
- è¤‡é›‘ã•ã‚’åŠ ãˆãšã«æ˜ç­ã•ã‚’åŠ ãˆã‚‹
- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã«ã¯ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã‚’å„ªå…ˆã™ã‚‹

## 6. ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (Task Execution Workflow)

### 6.1. ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª (Working Directory)

`./copilot/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ã‚³ãƒŸãƒƒãƒˆå¯¾è±¡å¤–ã®ä½œæ¥­é ˜åŸŸã§ã‚ã‚‹ã€‚ç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã€ãƒ¡ãƒ¢ã€ä¸­é–“æˆæœç‰©ã¯ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã—ã€è‡ªç”±ã«æ´»ç”¨ã™ã‚‹ã“ã¨ã€‚

### 6.2. å¤§è¦æ¨¡ã‚¿ã‚¹ã‚¯ã®é€²ã‚æ–¹ (Large Task Protocol)

è¦æ¨¡ã®å¤§ããªã‚¿ã‚¹ã‚¯ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦é€²ã‚ã‚‹ã“ã¨ã€‚

- ã‚¿ã‚¹ã‚¯å®šç¾©: `./copilot/tasks/{task_name}/task.md` ã‚’ä½œæˆã—ã€ã‚¿ã‚¹ã‚¯ã®ç›®çš„ã¨è¦ä»¶ã‚’è¨˜è¿°ã™ã‚‹ã€‚
- ã‚¿ã‚¹ã‚¯åˆ†å‰²: ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè£…å¯èƒ½ãªç²’åº¦ã«åˆ†å‰²ã—ã€`task.md` ã«ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå½¢å¼ã§è¨˜è¿°ã™ã‚‹ã€‚
- é€²æ—ç®¡ç†: `./copilot/tasks/{task_name}/todo.md` ã‚’ä½œæˆã—ã€ç¾åœ¨ã®é€²æ—ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¨˜éŒ²ã™ã‚‹ã€‚é€²æ—ã¯é »ç¹ã«æ›´æ–°ã™ã‚‹ã“ã¨ã€‚
- èª²é¡Œç®¡ç†: ç™ºç”Ÿã—ãŸç–‘å•ç‚¹ã‚„èª²é¡Œã¯éƒ½åº¦ãƒ¡ãƒ¢ã—ã€å¿…è¦ã«å¿œã˜ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è³ªå•ãƒ»ç¢ºèªã‚’è¡Œã†ã€‚

## 7. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† (Version Control)

### 7.1. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (Commit Messages)

Conventional Commits ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¾“ã†ã“ã¨ã€‚

- ã‚¿ã‚¤ãƒˆãƒ« (æ—¥æœ¬èª): å¤‰æ›´å†…å®¹ãŒæ˜ç¢ºã«ã‚ã‹ã‚‹ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã€‚ (feat(ui): æ–°ã—ã„ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ  ãªã©)
- èª¬æ˜ (æ—¥æœ¬èª): æœ¬æ–‡ã«ã¯ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å«ã‚ã‚‹ã€‚
- æ¦‚è¦: å¤‰æ›´ã®ç›®çš„ã‚’ç°¡æ½”ã«è¨˜è¿°ã€‚
- å¤‰æ›´ç‚¹: å…·ä½“çš„ãªå¤‰æ›´å†…å®¹ã‚’ãƒªã‚¹ãƒˆå½¢å¼ã§è¨˜è¿°ã€‚

## 8. é–‹ç™ºãƒ„ãƒ¼ãƒ«ã¨ã‚³ãƒãƒ³ãƒ‰

### 8.1. é–‹ç™ºãƒ„ãƒ¼ãƒ« (Development Tools)

- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†: uv
- ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼: poethepoet
- ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿: ruff
- lint ãƒ„ãƒ¼ãƒ«: ruff
- å‹ãƒã‚§ãƒƒã‚«ãƒ¼: pyright
- ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯: pytest

### 8.2. ä¸»è¦ã‚³ãƒãƒ³ãƒ‰ (Key Commands)

```shell
# Add package
uv add package-name

# Sync project dependencies
uv run poe sync
# Sync project with openvino(åŸºæœ¬ã¯ä½¿ç”¨ã—ãªã„)
uv run poe sync-openvino

# Run linter and formatter
uv run poe fix
# or
uv run poe check

# Run tests
uv run poe test

# Run the application
uv run poe run # windows app
uv run poe web # web app
uv run poe cli # cli app (testing logic)
```

## 8. æå‡ºå‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ (Pre-Submission Checklist)

ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã‚’é€ä¿¡ã™ã‚‹å‰ã«:

[ ] ã‚³ãƒ¼ãƒ‰å“è³ª: `uv run poe fix` ãŠã‚ˆã³ `uv run poe test` ãŒãƒ‘ã‚¹ã—ãŸã‹ã€‚
[ ] å‹ãƒ’ãƒ³ãƒˆ: å…¨ã¦ã®é–¢æ•°ã«å‹ãƒ’ãƒ³ãƒˆã¨æˆ»ã‚Šå€¤ã®å‹ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ã€‚
[ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³: å…¬é–‹é–¢æ•°ã« Google ã‚¹ã‚¿ã‚¤ãƒ«ã® docstring ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‹ã€‚
[ ] ãƒ†ã‚¹ãƒˆ: æ–°æ©Ÿèƒ½ãƒ»ä¿®æ­£ã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆãŒè¿½åŠ ã•ã‚Œã€å…¨ã¦ãƒ‘ã‚¹ã—ã¦ã„ã‚‹ã‹ã€‚
[ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: å±é™ºãªã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ã€‚
[ ] ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: Conventional Commits ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¾“ã£ã¦ã„ã‚‹ã‹ã€‚

<!-- OPENSPEC:START -->

# OpenSpec Instructions

These instructions are for AI assistants working in this project.

Always open `@/openspec/AGENTS.md` when the request:

- Mentions planning or proposals (words like proposal, spec, change, plan)
- Introduces new capabilities, breaking changes, architecture shifts, or big performance/security work
- Sounds ambiguous and you need the authoritative spec before coding

Use `@/openspec/AGENTS.md` to learn:

- How to create and apply change proposals
- Spec format and conventions
- Project structure and guidelines

Keep this managed block so 'openspec update' can refresh the instructions.

<!-- OPENSPEC:END -->
